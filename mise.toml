[hooks]
postinstall = [
  "{% set is_in_ci = get_env(name='CI', default='') %}{% if is_in_ci %}echo 'Not setting up git hooks as mise is running in CI!'{% else %}pre-commit install -c .config/.pre-commit-config.yaml{% endif %}",
]

[settings]
experimental = true # Needed for hooks as of v2025.6.2
windows_default_inline_shell_args = "powershell.exe /c"

[tasks.copier-update]
run = "copier update --answers-file .config/copier-answers.yml --skip-answered --trust"

[tasks.docs-server]
run = "mkdocs serve -f .config/mkdocs/mkdocs.yml"

[tasks.test]
run = '''
pre-commit run -c .config/.pre-commit-config.yaml --all-files
copier copy --trust --vcs-ref=HEAD --pretend -d 'repo_name=render-test' -d 'author_name=Name' -d 'repo_setup_actions=None' -d 'developer_platform=GitHub' -d 'github_username=username' -d 'github_org=' -d 'project_description=Rendering Test' -d 'project_type=Template' -d 'project_name=Rendering Test' -d 'project_visibility=Public' -d 'license=MIT' -d 'mkdocs_target=docs_site Directory in Repo' -d 'lifecycle=Pre-Alpha' . fake-path
'''
[tasks.integration-test-gh]
run = '''
copier copy --trust --vcs-ref={{option(name="branch",default="HEAD")}} -d 'developer_platform=GitHub' -d 'project_description=Integration Test - NOT FOR PUBLIC USE' -d 'project_type=Template' -d 'project_name=Integration Test' -d 'project_visibility=Public' -d 'license=MIT' -d 'lifecycle=Pre-Alpha' https://github.com/natescherer/postmodern-repo-copiertemplate {{option(name="path")}}
'''

[tasks.integration-test-azdo]
run = '''
copier copy --trust --vcs-ref={{option(name="branch",default="HEAD")}} -d 'developer_platform=Azure DevOps' -d 'project_description=Integration Test - NOT FOR PUBLIC USE' -d 'project_type=Template' -d 'project_name=Integration Test' -d 'project_visibility=Private' -d 'license=None' -d 'lifecycle=Pre-Alpha' https://github.com/natescherer/postmodern-repo-copiertemplate {{option(name="path")}}
'''

[tools]
# Backends
python = "3.13.7" # Used by copier and pre-commit
# Tools
"pipx:pre-commit" = "4.3.0"
uv = "0.8.15" # Used by pipx tools
yamlfmt = "0.17.2" # Needed by VSCode extension bluebrown.yamlfmt, can be removed when https://github.com/bluebrown/vscode-extension-yamlfmt/issues/2 is resolved

[tools."pipx:copier"]
version = "9.10.0"
uvx_args = "--with copier-template-extensions==0.3.3 --with jinja2-shell-extension==2.1.1 --with jinja2-time==0.2.0 --with prompt-toolkit<=3.0.51"
# prompt-toolkit is pinned here because of https://github.com/tmbo/questionary/issues/454

[tools."pipx:invoke"]
version = "2.2.0"
uvx_args = "--with copier==9.9.0 --with githubkit==0.13.1 --with requests==2.32.4 --with rich==14.1.0"

[tools."pipx:mkdocs"]
version = "1.6.1"
uvx_args = "--with mkdocs-material[imaging]==9.6.16 --with mkdocs-static-i18n==1.3.0 --with mike==2.1.3"
